<%
	@page_title = "Drop Test"
%>

<div class="threeW">
	<h2>Selected Assets:</h2>
	
	<div id="my_assets" style="">
	<p><i>Drop assets here to add them to your story</i></p>
	</div>	
</div>
<div class="sixW endcap">
	<div class="oneW"><h2>Search:</h2></div>
	<div class="fiveW endcap" id="search_box"></div>
	<br class="clear"/>
	
	<div id="asset_browser" class="assetbox"></div>
	
</div>

<br class="clear"/>

<script type="text/javascript">
	chooser = new AssetHost.ChooserUI({
		browser:new AssetHost.BrowserUI({
			assets:<%= (@assets.map { |a| a.json }).to_json.html_safe %>,
			page: <%= @assets.current_page %>,
			total: <%= @assets.total_entries %>
		})
	})
	
	window.opener.postMessage("LOADED","*")
	
	$(window).bind("message", function (evt) {
	    evt = evt.originalEvent
	    
	    chooser.selectAssets(evt.data)
        console.log("got message of ", evt)
        
        chooser.bind('saveAndClose',function(json) {
           evt.source.postMessage(json,evt.origin)
           window.close()
        })
	})
    	
	$(".ui-widget-overlay").live('click', function(){
	   $(".ui-dialog-titlebar-close").trigger('click');
	});
</script>